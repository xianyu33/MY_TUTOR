<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>验证码测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .captcha-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .captcha-image {
            border: 1px solid #ccc;
            margin: 10px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .info {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>验证码图片测试</h1>
    
    <div class="captcha-container">
        <h3>获取验证码</h3>
        <button onclick="getCaptcha()">获取新验证码</button>
        
        <div id="captcha-info" class="info" style="display: none;">
            <p><strong>验证码ID:</strong> <span id="captcha-id"></span></p>
            <p><strong>验证码文本:</strong> <span id="captcha-text"></span></p>
            <p><strong>图片大小:</strong> <span id="image-size"></span> 字符</p>
        </div>
        
        <div id="captcha-image-container" style="display: none;">
            <h4>验证码图片:</h4>
            <img id="captcha-image" class="captcha-image" alt="验证码图片">
        </div>
    </div>
    
    <div class="captcha-container">
        <h3>验证码测试</h3>
        <input type="text" id="captcha-input" placeholder="请输入验证码" maxlength="4">
        <button onclick="validateCaptcha()">验证</button>
        <div id="validation-result"></div>
    </div>

    <script>
        let currentCaptchaId = '';
        let currentCaptchaText = '';
        
        async function getCaptcha() {
            try {
                const response = await fetch('/user/getLoginCaptcha', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    currentCaptchaId = result.data.captchaId;
                    currentCaptchaText = result.data.captcha;
                    
                    // 显示验证码信息
                    document.getElementById('captcha-id').textContent = currentCaptchaId;
                    document.getElementById('captcha-text').textContent = currentCaptchaText;
                    document.getElementById('image-size').textContent = result.data.captchaImage.length;
                    document.getElementById('captcha-info').style.display = 'block';
                    
                    // 显示验证码图片
                    document.getElementById('captcha-image').src = result.data.captchaImage;
                    document.getElementById('captcha-image-container').style.display = 'block';
                    
                    console.log('验证码获取成功:', result.data);
                } else {
                    alert('获取验证码失败: ' + result.message);
                }
            } catch (error) {
                console.error('获取验证码时发生错误:', error);
                alert('获取验证码时发生错误: ' + error.message);
            }
        }
        
        function validateCaptcha() {
            const inputCaptcha = document.getElementById('captcha-input').value;
            const resultDiv = document.getElementById('validation-result');
            
            if (!currentCaptchaText) {
                resultDiv.innerHTML = '<p style="color: red;">请先获取验证码</p>';
                return;
            }
            
            if (inputCaptcha === currentCaptchaText) {
                resultDiv.innerHTML = '<p style="color: green;">验证码正确！</p>';
            } else {
                resultDiv.innerHTML = '<p style="color: red;">验证码错误！</p>';
            }
        }
        
        // 页面加载时自动获取一个验证码
        window.onload = function() {
            getCaptcha();
        };
    </script>
</body>
</html>

